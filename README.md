# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой данных отвечает за хранение и изменение данных.
- слой представления отвечает за отображение данных.
- презентер отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
- `handleResponse` - обрабатывает ответ с сервера.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   
- `onAll` — подписывает на все события
- `ofAll` — сбрасывает все обработчики событий
- `off` — убирает события

### Слой данных
#### Класс Model
Абстрактный класс для создания модельных данных.
##### Свойства Model
protected readonly component: HTMLElement — корневой DOM-элемент protected readonly component: HTMLElement — корневой DOM-элемент
##### Конструктор Model
(data:Partial, events: IEvenets) — принимает начальный данные для модели и объект событий для уведомления об изменениях в модели.
##### Методы Model
emitChanges(event: string, payload?: object) — запускает событие с переданным названием и данными, уведомляя подписчиков в изменении модели

#### Класс AppState
Является представлением глобального состояния приложения. Наследуется от: Model
##### В полях класса хранятся следующие данные:
- catalog: IProductItem[]: Массив объектов товаров в каталоге.
- order: IOrderForm: Объект с данными, необходимыми для формления заказа.
- formErrors: FormErrors: Объект, содержащий ошибки, возникающие при некорректном заполнении формы заказа.
##### Методы класса:
- setCatalog - установка каталога товаров 
- addBasket - добавление товара в корзину.
- removeBasket - удаление товара из корзины.
- sumCardsInBasket - количество товаров в корзине.
- getTotal - вычисление общей стоимости товаров.•	
- clearBasket - очистка корзины и заказа.
- setItems - добавление ID товаров в корзине в поле items для order.
- setOrderField - установка данных способов оплаты и адреса при успешной валидации
- setContactsField - установка значения поля контактной информации и проверки наличия достаточных контактных данных для оформления заказа.
- validateContact - валидация полей контактов
- resetForm - сброс значений формы.
- resetSelected - обновление поля selected во всех товарах после совершения покупки.



### Слой представления View

#### Класс Component
Абстрактный базовый класс. Является родительским для всех классов слоя представления.Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

##### Методы класса:
- toggleClass - переключает классов
- render - возвращает корневой DOM-элемент
- setText - устанавливает текстовое содержимое  компонента
- setImage - устанавливает изображение
- setDisabled - меняет статус блокировки
- setHidden - скрывает компонент
- setVisible - делает видимим компонент

#### Класс Card
Класс служит для отрисовки карточек Наследуется от: Component 
##### Поля класса:
- protected _category?: HTMLElement: Элемент для отображения категории продукта.
- protected _price: HTMLElement: Элемент для отображения цены продукта.
- protected _button?: HTMLButtonElement: Элемент кнопки.
- protected _title: HTMLElement: Элемент заголовка продукта.
- protected _image?: HTMLImageElement: Элемент изображения продукта.
- protected _description?: HTMLElement: Элемент описания продукта.
##### Методы класса:
- set id - устанавливает идентификатор продукта.
- set selected - устанавливает условие выбрали товар или нет.
- set price - Устанавливает цену продукта.
- set description - устанавливает описания продукта.
- set title - станавливает заголовок продукта.
- set image - устанавливает изображение продукта.
- set category- устанавливает категорию продукта.


#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.   Наследуется от: Component 
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.
##### Поля класса:
- _closeButton: HTMLButtonElement: Кнопка для закрытия модального окна.
- _content: HTMLElement: Элемент контента модального окна.
- events: IEvents - брокер событий
##### Методы класса:
- set content - устанавливает содержимое модального окна (сеттер).
- open - открывает модальное окно и отправляет соответствующее событие.
- close - закрывает модальное окно, очищает контент и отправляет соответствующее событие.
- render - выполняет рендеринг модального окна с учетом переданных данных.

#### Класс Page:
Управляет отображением содержимого главной страницы приложения, такими как каталог продуктов и счетчик элементов. Наследуется от: Component
##### Поля класса:
- protected _catalog: HTMLElement: Элемент каталога товаров.
- protected _basket: HTMLElement: Элемент корзины.
- protected _counter: HTMLElement: Элемент счетчика товаров в корзине.
- protected _wrapper: HTMLElement: Элемент обертки страницы.
##### Методы класса:
- set catalog - устанавливает список элементов каталога товаров на странице.
- set counter - устанавливает значение счетчика товаров в корзине.
- set locked - устанавливает состояние прокрутки.

#### Класс Form
Управляет отображением и взаимодействием с формами, такие установкой значений полей и валидации. Наследуется от: Component
##### Поля класса:
- protected _submit: HTMLButtonElement: Кнопка отправки формы.
- protected _errors: HTMLElement: Элемент для отображения ошибок формы.
Конструктор class Form принимает родительский элемент и обработчик событий
constructor(container: HTMLFormElement, events: IEvents)
##### Методы класса:
- set valid - устанавливает состояние кнопки отправки (активное/неактивное) в зависимости от валидности формы (сеттер).
- set errors - устанавливает значение текста ошибок в форме (сеттер).
- render - выполняет рендеринг компонентов формы с учетом переданного состояния.
- onInputChange - отправляет событие об изменении данных ввода.

#### Класс AddressForm
Класс формы для ввода адреса доставки товара. Наследуется от: Form 
##### Поле класса:
- protected _buttonPayments: HTMLButtonElement[]: Массив с элементами, отвечающими за выбор способа оплаты.
##### Метод класса:
- set address - устанавливает значение для поля адреса.

#### Класс ContactsForm
Класс формы для ввода контактных данных клиента. Наследуется от: Form 
##### Методы класса:
- set phone  - устанавливает значение для поля телефона.
- set email -  устанавливает значение для поля email.

#### Класс SuccessOrder
Класс отвечает за отображение интерфейса успешной покупки. Наследуется от: Component 
##### Поля класса:
- protected _close: HTMLElement: Элемент для кнопки закрытия сообщения.
- protected _successSum: HTMLElement: Элемент для отображения суммы списания.
##### Метод класса:
- set total - устанавливает текст со значением суммы списания.

#### Класс  Basket
Оторбражает корзину и входящие в него товары, а также предоставляет методы для управления элементами в корзине Наследуется от: Component 
##### Поля класса:
- protected _item: HTMLElement: Элемент списка товаров в корзине.
- protected _total: HTMLElement: Элемент для отображения общей стоимости товаров в корзине.
- protected _button: HTMLElement: Кнопка для оформления заказа.
Конструктор class Basket принимает родительский элемент и обработчик событий
constructor(container: HTMLElement, protected events: EventEmitter)
##### Методы класса:
- set selected - устанавливает список элементов товаров в корзине и состояние книпки оформления заказа (вкл. или выкл.) в зависимости от наличия товаров.
- set total - устанавливает общую стоимость товаров в корзине.
- disableButton - отключает кнопку "Оформить".
- refreshIndices - обновляет индексы таблички при удалении товара из корзины.


### Слой коммуникации

#### class APIapplication
Взаимодействие с конкретным API-сервером Наследуется от: Api 
##### В полях класса хранятся следующие данные:
- readonly cdn: string: URL-адрес контентного сервера.
##### Методы класса:
- getCards - получение списка товаров.
- getCardsId - получения информации о конкретном товаре по его идентификатору.
- getOrder - оформление заказа.


## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.\
Модель содержит данные, представление отображает данные, а презентер обрабатывает взаимодействие между моделью и представлением.
- card:select - при клике на карточку товара открывается модальное окно с подробным описанием товара.
- cards:changed - изменение списка товаров и вызывает перерисовку списка товаров на странице.
- card:toBasket - при клике на кнопку "В корзину" в модальном окне отправляет товар в корзину.
- basket:open - при клике на кнопку "корзина" открывает модальное окно с классом Basket, где отображаются товары добавленные в корзину.
- basket:delete - при клике на кнопку удаления товара в корзине удаляет тавары из корзины.
- order:open - при клике на кнопку "Оформить" в корзине открывает окно с формой для заполнения адреса и способа оплаты.
- order:submit - при нажатии на кнопку "Далее" на стадии заполнения адреса и способа оплаты в модальном окне.
- buttonPayments:select - при нажатии на кнопку выбора способа оплаты.
- addressFormErrors:change - при вводе данных в форму модального окна совершается процесс валидации формы, возвращает ошибки формы
- order:success - при успешном ответе сервера при оплате товара открывает модальное окно об успешной оплате
- modal:close - при клике на кнопку закрытия модального окна или при клике на свободное место вокруг модального окна снимает блокировку страницы и сбрасывает значение форм
- contactsFormErrors:change - при вводе данных в форму модального окна совершается процесс валидации формы, возвращает ошибки формы
- contacts:submit - при нажатии на кнопку "Оплатить" на этапе заполнения телефона и электронной почты в модальном окне

## Типы данных
### interface IProdItem - Интерфейс карточки товара
- id: string - идентификатор товара в магазине
- description: string - описание товара
- image: string - адрес картинки товара
- title: string - название товара
- category: string - категория товара
- price: number | null - цена товара
- selected: boolean - товар добавлен в корзину или нет
### interface IBasket - Интерфейс для содержимого корзины
- items: HTMLElement[] - элементы в корзине
- total: number - общая сумма
- list: HTMLElement[] - выбранные элементы
### interface IPage - Интерфейс страницы
- counter: number - счетчик товаров в корзине
- catalog: HTMLElement[] - массив карточек товаров
- locked: boolean - блокировка скрола
### interface IAddressForm - Интерфейс адреса
- payment:string- способ оплаты
- address: string - адрес доставки•	
### interface IContactsForm - Интерфейс контакты
- email: string - почта покупателя
- phone: string - телефон покупателя
### interface IModal - Интерфейс модального окна
- content: HTMLElement - содержимое модального окна
### interface IOrderForm extends IAddressForm, IContactsForm - Интерфейс информация о заказе
- total: number - сумма заказа
- items: string[] - массив идентификаторов купленных товаров
### interface IOderResult- Интерфейс успешной покупки
- id: string - айди заказа
- total: number - сумма заказа

